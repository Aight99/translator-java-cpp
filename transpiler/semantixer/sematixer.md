# Семантический анализатор

> **Вход:** дерево разбора.
>
> Проверяет семантику ЯП путем обхода по дереву разбора и проверкой условий.
>
> **Выход:** корректность дерева разбора (истинна или ошибка).

## Ошибки семантического анализатора

- Множественное объявление функции
- Наличие return-выражения
- Недостижимый код (после return)
- Использование необъявленной переменной
- Неправильный оператор для типа boolean
- Использование значения неинициализированной переменной
- Множественное объявление переменной
- Ошибка соответсвия типов
- Использование необъявленной функции
- Несоответсвие аргументов параметрам функции
- Двусмысленный вызов функции

## Известные проблемы

- Нет проверки вложенных return, чтобы они покрывали внешнюю область видимости

## Работа семантического анализатора

Семантический работает с корнем дерева разбора, полученного после
работы синтаксического анализатора:

1. Анализируется объявление функций в программе, проверяется уникальность сигнатур
2. Для каждой функции проверяется внутренний код:
    1. Если встречается инструкция, то проверяется достижимость кода
    2. Если встречается присваивание, то проверяется объявление переменной, по необходимости инициализация. Проверяются
       вложенные выражения на корректный вызов функций и соответсвие типов
    3. Если встречается объявление переменной, то проверяется её наличие в области видимости и присваиваемое выражение
    4. Если встречается вызов функции, то проверяется её сигнатура и соответствие аргументов параметрам
    5. Если встречается return, то проверяется тип возвращаемого выражения и его соответствие типу функции
    6. Если встречается цикл for, то переменная-счётчик заносится в следующую вложенность видимости
    7. Если встречается {, то инициализируется следующая вложенность видимости
    8. Если встречается }, то очищается текущая вложенность видимости

## План работы

1. [x] Собрать все методы с их требованиями в переменную
2. [x] Проверить имена методов и аргументов на ключевые слова
3. [x] Проверять, что сигнатуры методов не повторяются
4. [x] Проверить внутренний код всех методов
5. [x] Занести параметры в область видимости 0
6. [x] Заносить инициализированные переменные в область видимости
7. [x] Переменная объявлена один раз в области видимости
8. [x] Обращение идёт к объявленным переменным и функциям
9. [x] Вызов методы с требуемым количеством параметров
10. [x] Проверить типизацию в выражениях и в соответствии с типом переменной/параметра
11. [x] Проверить инициализацию значения переменной перед использованием в выражении
12. [x] Проверить, что return в конце своего блока
13. [x] При присваивании проверить, что для boolean нет инкремента и присваивания с операцией
14. [x] Добавить проверку встроенных функций println, max, min
15. [x] Проверить добавление переменной из цикла for в словарь переменных